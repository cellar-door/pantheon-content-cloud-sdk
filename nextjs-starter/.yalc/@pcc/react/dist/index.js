'use strict';

var I = require('react');
var inMemoryCache_js = require('@apollo/client/cache/inmemory/inMemoryCache.js');
var ApolloClient_js = require('@apollo/client/core/ApolloClient.js');
var ApolloProvider_js = require('@apollo/client/react/context/ApolloProvider.js');
var useQuery_js = require('@apollo/client/react/hooks/useQuery.js');
var graphql = require('graphql');
var jsxRuntime = require('react/jsx-runtime');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var I__default = /*#__PURE__*/_interopDefault(I);

var M=Object.defineProperty,$=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var O=(e,r,t)=>r in e?M(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,c=(e,r)=>{for(var t in r||(r={}))G.call(r,t)&&O(e,t,r[t]);if(E)for(var t of E(r))H.call(r,t)&&O(e,t,r[t]);return e},g=(e,r)=>$(e,V(r));var x=(e,r,t)=>new Promise((n,i)=>{var o=a=>{try{s(t.next(a));}catch(p){i(p);}},l=a=>{try{s(t.throw(a));}catch(p){i(p);}},s=a=>a.done?n(a.value):Promise.resolve(a.value).then(o,l);s((t=t.apply(e,r)).next());});var h=function(){return h=Object.assign||function(r){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o]);}return r},h.apply(this,arguments)};var m=new Map,_=new Map,L=!0,d=!1;function T(e){return e.replace(/[\s,]+/g," ").trim()}function k(e){return T(e.source.body.substring(e.start,e.end))}function z(e){var r=new Set,t=[];return e.definitions.forEach(function(n){if(n.kind==="FragmentDefinition"){var i=n.name.value,o=k(n.loc),l=_.get(i);l&&!l.has(o)?L&&console.warn("Warning: fragment with name "+i+` already exists.
graphql-tag enforces all fragment names across your application to be unique; read more about
this in the docs: http://dev.apollodata.com/core/fragments.html#unique-names`):l||_.set(i,l=new Set),l.add(o),r.has(o)||(r.add(o),t.push(n));}else t.push(n);}),h(h({},e),{definitions:t})}function Y(e){var r=new Set(e.definitions);r.forEach(function(n){n.loc&&delete n.loc,Object.keys(n).forEach(function(i){var o=n[i];o&&typeof o=="object"&&r.add(o);});});var t=e.loc;return t&&(delete t.startToken,delete t.endToken),e}function J(e){var r=T(e);if(!m.has(r)){var t=graphql.parse(e,{experimentalFragmentVariables:d,allowLegacyFragmentVariables:d});if(!t||t.kind!=="Document")throw new Error("Not a valid GraphQL document.");m.set(r,Y(z(t)));}return m.get(r)}function f(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];typeof e=="string"&&(e=[e]);var n=e[0];return r.forEach(function(i,o){i&&i.kind==="Document"?n+=i.loc.source.body:n+=i,n+=e[o+1];}),J(n)}function X(){m.clear(),_.clear();}function B(){L=!1;}function Z(){d=!0;}function K(){d=!1;}var y={gql:f,resetCaches:X,disableFragmentWarnings:B,enableExperimentalFragmentVariables:Z,disableExperimentalFragmentVariables:K};(function(e){e.gql=y.gql,e.resetCaches=y.resetCaches,e.disableFragmentWarnings=y.disableFragmentWarnings,e.enableExperimentalFragmentVariables=y.enableExperimentalFragmentVariables,e.disableExperimentalFragmentVariables=y.disableExperimentalFragmentVariables;})(f||(f={}));f.default=f;var b=f;var W=I__default.default.createContext(null),ee=({client:e,children:r})=>jsxRuntime.jsx(W.Provider,{value:e,children:jsxRuntime.jsx(ApolloProvider_js.ApolloProvider,{client:e.apolloClient,children:r})}),D=()=>{let e=I__default.default.useContext(W);if(!e)throw new Error("Cannot use outside of a PantheonProvider");return e};var N=console,Q={error:()=>{},info:()=>{},warn:()=>{}};var P=class{constructor(r){if(this.host=r.pccHost,this.wsHost=r.pccWsHost||r.pccHost.replace(/^http/,"ws").replace(/^https/,"wss"),this.debug=r.debug||!1,this.logger=this.debug?N:Q,!this.host)throw new Error("Missing Pantheon Content Cloud host");this.apolloClient=new ApolloClient_js.ApolloClient({uri:`${this.host}/query`,cache:new inMemoryCache_js.InMemoryCache}),this.debug&&this.logger.info("PantheonClient initialized with config",r);}};var C=b`
  query ListArticles(
    $contentType: ContentType
    $publishingLevel: PublishingLevel
  ) {
    articles(contentType: $contentType, publishingLevel: $publishingLevel) {
      id
      title
      source
      sourceURL
      keywords
      publishedDate
      publishingLevel
      contentType
    }
  }
`;function te(e,r){return x(this,null,function*(){return (yield e.apolloClient.query({query:C,variables:r})).data.articles})}var A=b`
  query GetArticle(
    $id: String!
    $contentType: ContentType
    $publishingLevel: PublishingLevel
  ) {
    article(
      id: $id
      contentType: $contentType
      publishingLevel: $publishingLevel
    ) {
      id
      title
      content
      source
      sourceURL
      keywords
      publishedDate
      publishingLevel
      contentType
    }
  }
`;function re(e,r,t){return x(this,null,function*(){return (yield e.apolloClient.query({query:A,variables:c({id:r},t)})).data.article})}var ne=(e,r)=>{var s;let{wsHost:t,logger:n}=D(),i=useQuery_js.useQuery(A,{variables:c({id:e},r)}),o=I.useRef(),l=I.useRef();return I.useEffect(()=>{l.current=e;},[e]),I.useEffect(()=>{if(o.current!=null)return;let a=new WebSocket(`${t}/ws`);o.current=a,a.addEventListener("open",()=>{n.info("Connected to the GraphQL backend."),a.send(JSON.stringify({Command:"subchanges",Id:e}));}),a.addEventListener("close",()=>{n.info("%cDisconnected and lonely","color: red;");}),a.addEventListener("message",p=>{let u=JSON.parse(p.data);switch(u.Command){case"refetch":{u.Id===l.current&&(n.info("%cNew content is available - refetching...","color: yellow;"),i.refetch());break}case"doc_gone":{u.Id===l.current&&n.error("Document has been deleted");break}case"debug":{n.info({json:u});break}default:n.error(`Unrecognized command ${u.Command}`,u);}});},[]),I.useEffect(()=>{var a;((a=o.current)==null?void 0:a.readyState)===WebSocket.OPEN&&o.current.send(JSON.stringify({Command:"subchanges",Id:e}));},[e]),I.useEffect(()=>{n.info("%cSuccessfully fetched updated content","color: lime;");},[i.data]),g(c({},i),{article:(s=i.data)==null?void 0:s.article})};var oe=e=>{var t;let r=useQuery_js.useQuery(C,{variables:e});return g(c({},r),{articles:(t=r.data)==null?void 0:t.articles})};var ie=(n=>(n.production="PRODUCTION",n.realtime="REALTIME",n.staging="STAGING",n))(ie||{}),ae=(t=>(t.TEXT_MARKDOWN="TEXT_MARKDOWN",t.TREE_PANTHEON="TREE_PANTHEON",t))(ae||{});

exports.ContentType = ae;
exports.PantheonClient = P;
exports.PantheonProvider = ee;
exports.PublishingLevel = ie;
exports.getArticle = re;
exports.getArticles = te;
exports.useArticle = ne;
exports.useArticles = oe;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb3JlL3BhbnRoZW9uLWNvbnRleHQudHN4IiwiLi4vc3JjL2xpYi9hcG9sbG8tY2xpZW50L2luZGV4LnRzIiwiLi4vbm9kZV9tb2R1bGVzL3RzbGliL3RzbGliLmVzNi5qcyIsIi4uL25vZGVfbW9kdWxlcy9ncmFwaHFsLXRhZy9zcmMvaW5kZXgudHMiLCIuLi9zcmMvdXRpbHMvbG9nZ2VyLnRzIiwiLi4vc3JjL2NvcmUvcGFudGhlb24tY2xpZW50LnRzIiwiLi4vc3JjL2hvb2tzL3VzZS1hcnRpY2xlLnRzIiwiLi4vc3JjL2xpYi9hcnRpY2xlcy9pbmRleC50cyIsIi4uL3NyYy9ob29rcy91c2UtYXJ0aWNsZXMudHMiLCIuLi9zcmMvdHlwZXMvaW5kZXgudHMiXSwibmFtZXMiOlsiUmVhY3QiLCJJbk1lbW9yeUNhY2hlIiwiQXBvbGxvQ2xpZW50IiwiQXBvbGxvUHJvdmlkZXIiLCJ1c2VRdWVyeSIsIl9fYXNzaWduIiwidCIsInMiLCJpIiwibiIsInAiLCJwYXJzZSIsImRvY0NhY2hlIiwiZnJhZ21lbnRTb3VyY2VNYXAiLCJwcmludEZyYWdtZW50V2FybmluZ3MiLCJleHBlcmltZW50YWxGcmFnbWVudFZhcmlhYmxlcyIsIm5vcm1hbGl6ZSIsInN0cmluZyIsImNhY2hlS2V5RnJvbUxvYyIsImxvYyIsInByb2Nlc3NGcmFnbWVudHMiLCJhc3QiLCJzZWVuS2V5cyIsImRlZmluaXRpb25zIiwiZnJhZ21lbnREZWZpbml0aW9uIiwiZnJhZ21lbnROYW1lIiwic291cmNlS2V5Iiwic291cmNlS2V5U2V0Iiwic3RyaXBMb2MiLCJkb2MiLCJ3b3JrU2V0Iiwibm9kZSIsImtleSIsInZhbHVlIiwicGFyc2VEb2N1bWVudCIsInNvdXJjZSIsImNhY2hlS2V5IiwicGFyc2VkIiwiZ3FsIiwibGl0ZXJhbHMiLCJhcmdzIiwiX2kiLCJyZXN1bHQiLCJhcmciLCJyZXNldENhY2hlcyIsImRpc2FibGVGcmFnbWVudFdhcm5pbmdzIiwiZW5hYmxlRXhwZXJpbWVudGFsRnJhZ21lbnRWYXJpYWJsZXMiLCJkaXNhYmxlRXhwZXJpbWVudGFsRnJhZ21lbnRWYXJpYWJsZXMiLCJleHRyYXMiLCJncWxfMSIsImxpYl9kZWZhdWx0IiwianN4IiwiUGFudGhlb25Db250ZXh0IiwiUGFudGhlb25Qcm92aWRlciIsImNsaWVudCIsImNoaWxkcmVuIiwidXNlUGFudGhlb25DbGllbnQiLCJEZWZhdWx0TG9nZ2VyIiwiTm9vcExvZ2dlciIsIlBhbnRoZW9uQ2xpZW50IiwiY29uZmlnIiwidXNlRWZmZWN0IiwidXNlUmVmIiwiTElTVF9BUlRJQ0xFU19RVUVSWSIsImdldEFydGljbGVzIiwiX19hc3luYyIsIkdFVF9BUlRJQ0xFX1FVRVJZIiwiZ2V0QXJ0aWNsZSIsImlkIiwiX19zcHJlYWRWYWx1ZXMiLCJ1c2VBcnRpY2xlIiwiX2EiLCJ3c0hvc3QiLCJsb2dnZXIiLCJxdWVyeURhdGEiLCJzb2NrZXRSZWYiLCJpZFJlZiIsInNvY2tldCIsImUiLCJqc29uIiwiX19zcHJlYWRQcm9wcyIsInVzZUFydGljbGVzIiwiUHVibGlzaGluZ0xldmVsIiwiQ29udGVudFR5cGUiXSwibWFwcGluZ3MiOiIwbkJBQUEsT0FBT0EsTUFBa0MsUUNTekMsT0FBUyxpQkFBQUMsTUFBcUIsaURBQzlCLE9BQVMsZ0JBQUFDLE1BQW9CLHNDQUM3QixPQUFTLGtCQUFBQyxNQUFzQixpREFDL0IsT0FBUyxZQUFBQyxNQUFnQix5Q0NtQmxCLElBQUlDLEVBQVcsVUFBVyxDQUM3QixPQUFBQSxFQUFXLE9BQU8sUUFBVSxTQUFrQkMsRUFBRyxDQUM3QyxRQUFTQyxFQUFHQyxFQUFJLEVBQUdDLEVBQUksVUFBVSxPQUFRRCxFQUFJQyxFQUFHRCxJQUFLLENBQ2pERCxFQUFJLFVBQVVDLENBQUMsRUFDZixRQUFTRSxLQUFLSCxFQUFPLE9BQU8sVUFBVSxlQUFlLEtBQUtBLEVBQUdHLENBQUMsSUFBR0osRUFBRUksQ0FBQyxFQUFJSCxFQUFFRyxDQUFDLEdBRS9FLE9BQU9KLENBQ1gsRUFDT0QsRUFBUyxN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QUF3Qk0sRUFBSyxVQUFXQSxDQUFJLENBRTdELENBQ0YsQ0FBQyxDQUNILEVBQUcsQ0FBQyxDQUFDLEVBRUxsQixFQUFVLElBQU0sQ0F6RWxCLElBQUFVLElBMEVRQSxFQUFBSSxFQUFVLFVBQVYsWUFBQUosRUFBbUIsY0FBZSxVQUFVLE1BQzlDSSxFQUFVLFFBQVEsS0FDaEIsS0FBSyxVQUFVLENBQ2IsUUFBUyxhQUNULEdBQUlQLENBQ04sQ0FBQyxDQUNILENBRUosRUFBRyxDQUFDQSxDQUFFLENBQUMsRUFFUFAsRUFBVSxJQUFNLENBQ2RZLEVBQU8sS0FBSyx5Q0FBMEMsY0FBYyxDQUN0RSxFQUFHLENBQUNDLEVBQVUsSUFBSSxDQUFDLEVBRVpNLEVBQUFYLEVBQUEsR0FDRkssR0FERSxDQUVMLFNBQVNILEVBQUFHLEVBQVUsT0FBVixZQUFBSCxFQUFnQixPQUMzQixFQUNGLEVFcEZPLElBQU1VLEdBQWV6QyxHQUE0QixDQVJ4RCxJQUFBK0IsRUFTRSxJQUFNRyxFQUFZdEUsRUFBK0IyRCxFQUFxQixDQUNwRSxVQUFXdkIsQ0FDYixDQUFDLEVBRUQsT0FBT3dDLEVBQUFYLEVBQUEsR0FDRkssR0FERSxDQUVMLFVBQVVILEVBQUFHLEVBQVUsT0FBVixZQUFBSCxFQUFnQixRQUM1QixFQUNGLEVDSE8sSUFBS1csUUFDVkEsRUFBQSxXQUFhLGFBQ2JBLEVBQUEsU0FBVyxXQUNYQSxFQUFBLFFBQVUsVUFIQUEsUUFBQSxJQU1BQyxRQUNWQSxFQUFBLGNBQWdCLGdCQUNoQkEsRUFBQSxjQUFnQixnQkFGTkEsUUFBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBQcm9wc1dpdGhDaGlsZHJlbiB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHsgQXBvbGxvUHJvdmlkZXIgfSBmcm9tICcuLi9saWIvYXBvbGxvLWNsaWVudCc7XG5cbmltcG9ydCB7IFBhbnRoZW9uQ2xpZW50IH0gZnJvbSAnLi9wYW50aGVvbi1jbGllbnQnO1xuXG5pbnRlcmZhY2UgUGFudGhlb25Qcm92aWRlclByb3BzIGV4dGVuZHMgUHJvcHNXaXRoQ2hpbGRyZW48YW55PiB7XG4gIGNsaWVudDogUGFudGhlb25DbGllbnQ7XG59XG5cbmNvbnN0IFBhbnRoZW9uQ29udGV4dCA9IFJlYWN0LmNyZWF0ZUNvbnRleHQ8UGFudGhlb25DbGllbnQgfCBudWxsPihudWxsKTtcblxuZXhwb3J0IGNvbnN0IFBhbnRoZW9uUHJvdmlkZXIgPSAoe1xuICBjbGllbnQsXG4gIGNoaWxkcmVuLFxufTogUGFudGhlb25Qcm92aWRlclByb3BzKSA9PiAoXG4gIDxQYW50aGVvbkNvbnRleHQuUHJvdmlkZXIgdmFsdWU9e2NsaWVudH0+XG4gICAgPEFwb2xsb1Byb3ZpZGVyIGNsaWVudD17Y2xpZW50LmFwb2xsb0NsaWVudH0+e2NoaWxkcmVufTwvQXBvbGxvUHJvdmlkZXI+XG4gIDwvUGFudGhlb25Db250ZXh0LlByb3ZpZGVyPlxuKTtcblxuZXhwb3J0IGNvbnN0IHVzZVBhbnRoZW9uQ2xpZW50ID0gKCkgPT4ge1xuICBjb25zdCBjbGllbnQgPSBSZWFjdC51c2VDb250ZXh0KFBhbnRoZW9uQ29udGV4dCk7XG5cbiAgaWYgKCFjbGllbnQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCB1c2Ugb3V0c2lkZSBvZiBhIFBhbnRoZW9uUHJvdmlkZXInKTtcbiAgfVxuXG4gIHJldHVybiBjbGllbnQ7XG59O1xuIiwiLyoqXG4gKiBSZS1leHBvcnRpbmcgcmVxdWlyZWQgQXBvbGxvIG1vZHVsZXMgdG8gYXZvaWRcbiAqIFN5bnRheEVycm9yOiBOYW1lZCBleHBvcnQgJ0Fwb2xsb0NsaWVudCcgbm90IGZvdW5kLiBUaGUgcmVxdWVzdGVkIG1vZHVsZSAnQGFwb2xsby9jbGllbnQnIGlzXG4gKiBhIENvbW1vbkpTIG1vZHVsZSwgd2hpY2ggbWF5IG5vdCBzdXBwb3J0IGFsbCBtb2R1bGUuZXhwb3J0cyBhcyBuYW1lZCBleHBvcnRzLlxuICpcbiAqIEVTTSByZXF1aXJlcyB0aGF0IGludGVybmFsIHBhY2thZ2UgaW1wb3J0cyBhcmUgYWJzb2x1dGVseSByZXNvbHZlZDtcbiAqIFRyYWNraW5nIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L1R5cGVTY3JpcHQvaXNzdWVzLzE2NTc3XG4gKi9cblxuaW1wb3J0IHsgSW5NZW1vcnlDYWNoZSB9IGZyb20gJ0BhcG9sbG8vY2xpZW50L2NhY2hlL2lubWVtb3J5L2luTWVtb3J5Q2FjaGUuanMnO1xuaW1wb3J0IHsgQXBvbGxvQ2xpZW50IH0gZnJvbSAnQGFwb2xsby9jbGllbnQvY29yZS9BcG9sbG9DbGllbnQuanMnO1xuaW1wb3J0IHsgQXBvbGxvUHJvdmlkZXIgfSBmcm9tICdAYXBvbGxvL2NsaWVudC9yZWFjdC9jb250ZXh0L0Fwb2xsb1Byb3ZpZGVyLmpzJztcbmltcG9ydCB7IHVzZVF1ZXJ5IH0gZnJvbSAnQGFwb2xsby9jbGllbnQvcmVhY3QvaG9va3MvdXNlUXVlcnkuanMnO1xuaW1wb3J0IGdxbCBmcm9tICdncmFwaHFsLXRhZyc7IC8vIEp1c3QgZm9yIGNvbnZlbmllbmNlXG5cbmV4cG9ydCB7IHVzZVF1ZXJ5LCBncWwsIEluTWVtb3J5Q2FjaGUsIEFwb2xsb0NsaWVudCwgQXBvbGxvUHJvdmlkZXIgfTtcbiIsIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uXHJcblxyXG5QZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnlcclxucHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLlxyXG5cclxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSFxyXG5SRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFlcclxuQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULFxyXG5JTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST01cclxuTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1JcclxuT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUlxyXG5QRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG4vKiBnbG9iYWwgUmVmbGVjdCwgUHJvbWlzZSAqL1xyXG5cclxudmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2V4dGVuZHMoZCwgYikge1xyXG4gICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcclxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiBfX2Fzc2lnbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3Jlc3QocywgZSkge1xyXG4gICAgdmFyIHQgPSB7fTtcclxuICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSAmJiBlLmluZGV4T2YocCkgPCAwKVxyXG4gICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGUuaW5kZXhPZihwW2ldKSA8IDAgJiYgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHMsIHBbaV0pKVxyXG4gICAgICAgICAgICAgICAgdFtwW2ldXSA9IHNbcFtpXV07XHJcbiAgICAgICAgfVxyXG4gICAgcmV0dXJuIHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2RlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19wYXJhbShwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSkge1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXRlcih0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2dlbmVyYXRvcih0aGlzQXJnLCBib2R5KSB7XHJcbiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xyXG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcclxuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XHJcbiAgICAgICAgd2hpbGUgKGcgJiYgKGcgPSAwLCBvcFswXSAmJiAoXyA9IDApKSwgXykgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xyXG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XHJcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxyXG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgdmFyIF9fY3JlYXRlQmluZGluZyA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcclxuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XHJcbiAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobSwgayk7XHJcbiAgICBpZiAoIWRlc2MgfHwgKFwiZ2V0XCIgaW4gZGVzYyA/ICFtLl9fZXNNb2R1bGUgOiBkZXNjLndyaXRhYmxlIHx8IGRlc2MuY29uZmlndXJhYmxlKSkge1xyXG4gICAgICAgIGRlc2MgPSB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH07XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIGRlc2MpO1xyXG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xyXG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcclxuICAgIG9bazJdID0gbVtrXTtcclxufSk7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIG8pIHtcclxuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKHAgIT09IFwiZGVmYXVsdFwiICYmICFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobywgcCkpIF9fY3JlYXRlQmluZGluZyhvLCBtLCBwKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fdmFsdWVzKG8pIHtcclxuICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7XHJcbiAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTtcclxuICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gXCJudW1iZXJcIikgcmV0dXJuIHtcclxuICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gXCJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLlwiIDogXCJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZWFkKG8sIG4pIHtcclxuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcclxuICAgIGlmICghbSkgcmV0dXJuIG87XHJcbiAgICB2YXIgaSA9IG0uY2FsbChvKSwgciwgYXIgPSBbXSwgZTtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgd2hpbGUgKChuID09PSB2b2lkIDAgfHwgbi0tID4gMCkgJiYgIShyID0gaS5uZXh0KCkpLmRvbmUpIGFyLnB1c2goci52YWx1ZSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cclxuICAgIGZpbmFsbHkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH1cclxuICAgIH1cclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZCgpIHtcclxuICAgIGZvciAodmFyIGFyID0gW10sIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgIGFyID0gYXIuY29uY2F0KF9fcmVhZChhcmd1bWVudHNbaV0pKTtcclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZEFycmF5cygpIHtcclxuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xyXG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxyXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxyXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcclxuICAgIHJldHVybiByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWRBcnJheSh0bywgZnJvbSwgcGFjaykge1xyXG4gICAgaWYgKHBhY2sgfHwgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgZm9yICh2YXIgaSA9IDAsIGwgPSBmcm9tLmxlbmd0aCwgYXI7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7XHJcbiAgICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XHJcbiAgICAgICAgICAgIGFyW2ldID0gZnJvbVtpXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdG8uY29uY2F0KGFyIHx8IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20pKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgaWYgKGdbbl0pIGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAocikgeyByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsgfVxyXG4gICAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoXCJuZXh0XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0RlbGVnYXRvcihvKSB7XHJcbiAgICB2YXIgaSwgcDtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiwgZnVuY3Rpb24gKGUpIHsgdGhyb3cgZTsgfSksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaVtuXSA9IG9bbl0gPyBmdW5jdGlvbiAodikgeyByZXR1cm4gKHAgPSAhcCkgPyB7IHZhbHVlOiBfX2F3YWl0KG9bbl0odikpLCBkb25lOiBuID09PSBcInJldHVyblwiIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xyXG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcclxuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydFN0YXIobW9kKSB7XHJcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xyXG4gICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xyXG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydERlZmF1bHQobW9kKSB7XHJcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IGRlZmF1bHQ6IG1vZCB9O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEdldChyZWNlaXZlciwgc3RhdGUsIGtpbmQsIGYpIHtcclxuICAgIGlmIChraW5kID09PSBcImFcIiAmJiAhZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgYWNjZXNzb3Igd2FzIGRlZmluZWQgd2l0aG91dCBhIGdldHRlclwiKTtcclxuICAgIGlmICh0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyICE9PSBzdGF0ZSB8fCAhZiA6ICFzdGF0ZS5oYXMocmVjZWl2ZXIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHJlYWQgcHJpdmF0ZSBtZW1iZXIgZnJvbSBhbiBvYmplY3Qgd2hvc2UgY2xhc3MgZGlkIG5vdCBkZWNsYXJlIGl0XCIpO1xyXG4gICAgcmV0dXJuIGtpbmQgPT09IFwibVwiID8gZiA6IGtpbmQgPT09IFwiYVwiID8gZi5jYWxsKHJlY2VpdmVyKSA6IGYgPyBmLnZhbHVlIDogc3RhdGUuZ2V0KHJlY2VpdmVyKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fY2xhc3NQcml2YXRlRmllbGRTZXQocmVjZWl2ZXIsIHN0YXRlLCB2YWx1ZSwga2luZCwgZikge1xyXG4gICAgaWYgKGtpbmQgPT09IFwibVwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBtZXRob2QgaXMgbm90IHdyaXRhYmxlXCIpO1xyXG4gICAgaWYgKGtpbmQgPT09IFwiYVwiICYmICFmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBhY2Nlc3NvciB3YXMgZGVmaW5lZCB3aXRob3V0IGEgc2V0dGVyXCIpO1xyXG4gICAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gXCJmdW5jdGlvblwiID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3Qgd3JpdGUgcHJpdmF0ZSBtZW1iZXIgdG8gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdFwiKTtcclxuICAgIHJldHVybiAoa2luZCA9PT0gXCJhXCIgPyBmLmNhbGwocmVjZWl2ZXIsIHZhbHVlKSA6IGYgPyBmLnZhbHVlID0gdmFsdWUgOiBzdGF0ZS5zZXQocmVjZWl2ZXIsIHZhbHVlKSksIHZhbHVlO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEluKHN0YXRlLCByZWNlaXZlcikge1xyXG4gICAgaWYgKHJlY2VpdmVyID09PSBudWxsIHx8ICh0eXBlb2YgcmVjZWl2ZXIgIT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIHJlY2VpdmVyICE9PSBcImZ1bmN0aW9uXCIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHVzZSAnaW4nIG9wZXJhdG9yIG9uIG5vbi1vYmplY3RcIik7XHJcbiAgICByZXR1cm4gdHlwZW9mIHN0YXRlID09PSBcImZ1bmN0aW9uXCIgPyByZWNlaXZlciA9PT0gc3RhdGUgOiBzdGF0ZS5oYXMocmVjZWl2ZXIpO1xyXG59XHJcbiIsImltcG9ydCB7IHBhcnNlIH0gZnJvbSAnZ3JhcGhxbCc7XG5cbmltcG9ydCB7XG4gIERvY3VtZW50Tm9kZSxcbiAgRGVmaW5pdGlvbk5vZGUsXG4gIExvY2F0aW9uLFxufSBmcm9tICdncmFwaHFsL2xhbmd1YWdlL2FzdCc7XG5cbi8vIEEgbWFwIGRvY1N0cmluZyAtPiBncmFwaHFsIGRvY3VtZW50XG5jb25zdCBkb2NDYWNoZSA9IG5ldyBNYXA8c3RyaW5nLCBEb2N1bWVudE5vZGU+KCk7XG5cbi8vIEEgbWFwIGZyYWdtZW50TmFtZSAtPiBbbm9ybWFsaXplZCBzb3VyY2VdXG5jb25zdCBmcmFnbWVudFNvdXJjZU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBTZXQ8c3RyaW5nPj4oKTtcblxubGV0IHByaW50RnJhZ21lbnRXYXJuaW5ncyA9IHRydWU7XG5sZXQgZXhwZXJpbWVudGFsRnJhZ21lbnRWYXJpYWJsZXMgPSBmYWxzZTtcblxuLy8gU3RyaXAgaW5zaWduaWZpY2FudCB3aGl0ZXNwYWNlXG4vLyBOb3RlIHRoYXQgdGhpcyBjb3VsZCBkbyBhIGxvdCBtb3JlLCBzdWNoIGFzIHJlb3JkZXIgZmllbGRzIGV0Yy5cbmZ1bmN0aW9uIG5vcm1hbGl6ZShzdHJpbmc6IHN0cmluZykge1xuICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoL1tcXHMsXSsvZywgJyAnKS50cmltKCk7XG59XG5cbmZ1bmN0aW9uIGNhY2hlS2V5RnJvbUxvYyhsb2M6IExvY2F0aW9uKSB7XG4gIHJldHVybiBub3JtYWxpemUobG9jLnNvdXJjZS5ib2R5LnN1YnN0cmluZyhsb2Muc3RhcnQsIGxvYy5lbmQpKTtcbn1cblxuLy8gVGFrZSBhIHVuc3RyaXBwZWQgcGFyc2VkIGRvY3VtZW50IChxdWVyeS9tdXRhdGlvbiBvciBldmVuIGZyYWdtZW50KSwgYW5kXG4vLyBjaGVjayBhbGwgZnJhZ21lbnQgZGVmaW5pdGlvbnMsIGNoZWNraW5nIGZvciBuYW1lLT5zb3VyY2UgdW5pcXVlbmVzcy5cbi8vIFdlIGFsc28gd2FudCB0byBtYWtlIHN1cmUgb25seSB1bmlxdWUgZnJhZ21lbnRzIGV4aXN0IGluIHRoZSBkb2N1bWVudC5cbmZ1bmN0aW9uIHByb2Nlc3NGcmFnbWVudHMoYXN0OiBEb2N1bWVudE5vZGUpIHtcbiAgY29uc3Qgc2VlbktleXMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgY29uc3QgZGVmaW5pdGlvbnM6IERlZmluaXRpb25Ob2RlW10gPSBbXTtcblxuICBhc3QuZGVmaW5pdGlvbnMuZm9yRWFjaChmcmFnbWVudERlZmluaXRpb24gPT4ge1xuICAgIGlmIChmcmFnbWVudERlZmluaXRpb24ua2luZCA9PT0gJ0ZyYWdtZW50RGVmaW5pdGlvbicpIHtcbiAgICAgIHZhciBmcmFnbWVudE5hbWUgPSBmcmFnbWVudERlZmluaXRpb24ubmFtZS52YWx1ZTtcbiAgICAgIHZhciBzb3VyY2VLZXkgPSBjYWNoZUtleUZyb21Mb2MoZnJhZ21lbnREZWZpbml0aW9uLmxvYyEpO1xuXG4gICAgICAvLyBXZSBrbm93IHNvbWV0aGluZyBhYm91dCB0aGlzIGZyYWdtZW50XG4gICAgICBsZXQgc291cmNlS2V5U2V0ID0gZnJhZ21lbnRTb3VyY2VNYXAuZ2V0KGZyYWdtZW50TmFtZSkhO1xuICAgICAgaWYgKHNvdXJjZUtleVNldCAmJiAhc291cmNlS2V5U2V0Lmhhcyhzb3VyY2VLZXkpKSB7XG4gICAgICAgIC8vIHRoaXMgaXMgYSBwcm9ibGVtIGJlY2F1c2UgdGhlIGFwcCBkZXZlbG9wZXIgaXMgdHJ5aW5nIHRvIHJlZ2lzdGVyIGFub3RoZXIgZnJhZ21lbnQgd2l0aFxuICAgICAgICAvLyB0aGUgc2FtZSBuYW1lIGFzIG9uZSBwcmV2aW91c2x5IHJlZ2lzdGVyZWQuIFNvLCB3ZSB0ZWxsIHRoZW0gYWJvdXQgaXQuXG4gICAgICAgIGlmIChwcmludEZyYWdtZW50V2FybmluZ3MpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oXCJXYXJuaW5nOiBmcmFnbWVudCB3aXRoIG5hbWUgXCIgKyBmcmFnbWVudE5hbWUgKyBcIiBhbHJlYWR5IGV4aXN0cy5cXG5cIlxuICAgICAgICAgICAgKyBcImdyYXBocWwtdGFnIGVuZm9yY2VzIGFsbCBmcmFnbWVudCBuYW1lcyBhY3Jvc3MgeW91ciBhcHBsaWNhdGlvbiB0byBiZSB1bmlxdWU7IHJlYWQgbW9yZSBhYm91dFxcblwiXG4gICAgICAgICAgICArIFwidGhpcyBpbiB0aGUgZG9jczogaHR0cDovL2Rldi5hcG9sbG9kYXRhLmNvbS9jb3JlL2ZyYWdtZW50cy5odG1sI3VuaXF1ZS1uYW1lc1wiKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICghc291cmNlS2V5U2V0KSB7XG4gICAgICAgIGZyYWdtZW50U291cmNlTWFwLnNldChmcmFnbWVudE5hbWUsIHNvdXJjZUtleVNldCA9IG5ldyBTZXQpO1xuICAgICAgfVxuXG4gICAgICBzb3VyY2VLZXlTZXQuYWRkKHNvdXJjZUtleSk7XG5cbiAgICAgIGlmICghc2VlbktleXMuaGFzKHNvdXJjZUtleSkpIHtcbiAgICAgICAgc2VlbktleXMuYWRkKHNvdXJjZUtleSk7XG4gICAgICAgIGRlZmluaXRpb25zLnB1c2goZnJhZ21lbnREZWZpbml0aW9uKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZGVmaW5pdGlvbnMucHVzaChmcmFnbWVudERlZmluaXRpb24pO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICAuLi5hc3QsXG4gICAgZGVmaW5pdGlvbnMsXG4gIH07XG59XG5cbmZ1bmN0aW9uIHN0cmlwTG9jKGRvYzogRG9jdW1lbnROb2RlKSB7XG4gIGNvbnN0IHdvcmtTZXQgPSBuZXcgU2V0PFJlY29yZDxzdHJpbmcsIGFueT4+KGRvYy5kZWZpbml0aW9ucyk7XG5cbiAgd29ya1NldC5mb3JFYWNoKG5vZGUgPT4ge1xuICAgIGlmIChub2RlLmxvYykgZGVsZXRlIG5vZGUubG9jO1xuICAgIE9iamVjdC5rZXlzKG5vZGUpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gbm9kZVtrZXldO1xuICAgICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgd29ya1NldC5hZGQodmFsdWUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBjb25zdCBsb2MgPSBkb2MubG9jIGFzIFJlY29yZDxzdHJpbmcsIGFueT47XG4gIGlmIChsb2MpIHtcbiAgICBkZWxldGUgbG9jLnN0YXJ0VG9rZW47XG4gICAgZGVsZXRlIGxvYy5lbmRUb2tlbjtcbiAgfVxuXG4gIHJldHVybiBkb2M7XG59XG5cbmZ1bmN0aW9uIHBhcnNlRG9jdW1lbnQoc291cmNlOiBzdHJpbmcpIHtcbiAgdmFyIGNhY2hlS2V5ID0gbm9ybWFsaXplKHNvdXJjZSk7XG4gIGlmICghZG9jQ2FjaGUuaGFzKGNhY2hlS2V5KSkge1xuICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlKHNvdXJjZSwge1xuICAgICAgZXhwZXJpbWVudGFsRnJhZ21lbnRWYXJpYWJsZXMsXG4gICAgICBhbGxvd0xlZ2FjeUZyYWdtZW50VmFyaWFibGVzOiBleHBlcmltZW50YWxGcmFnbWVudFZhcmlhYmxlcyxcbiAgICB9IGFzIGFueSk7XG4gICAgaWYgKCFwYXJzZWQgfHwgcGFyc2VkLmtpbmQgIT09ICdEb2N1bWVudCcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm90IGEgdmFsaWQgR3JhcGhRTCBkb2N1bWVudC4nKTtcbiAgICB9XG4gICAgZG9jQ2FjaGUuc2V0KFxuICAgICAgY2FjaGVLZXksXG4gICAgICAvLyBjaGVjayB0aGF0IGFsbCBcIm5ld1wiIGZyYWdtZW50cyBpbnNpZGUgdGhlIGRvY3VtZW50cyBhcmUgY29uc2lzdGVudCB3aXRoXG4gICAgICAvLyBleGlzdGluZyBmcmFnbWVudHMgb2YgdGhlIHNhbWUgbmFtZVxuICAgICAgc3RyaXBMb2MocHJvY2Vzc0ZyYWdtZW50cyhwYXJzZWQpKSxcbiAgICApO1xuICB9XG4gIHJldHVybiBkb2NDYWNoZS5nZXQoY2FjaGVLZXkpITtcbn1cblxuLy8gWFhYIFRoaXMgc2hvdWxkIGV2ZW50dWFsbHkgZGlzYWxsb3cgYXJiaXRyYXJ5IHN0cmluZyBpbnRlcnBvbGF0aW9uLCBsaWtlIFJlbGF5IGRvZXNcbmV4cG9ydCBmdW5jdGlvbiBncWwoXG4gIGxpdGVyYWxzOiBzdHJpbmcgfCByZWFkb25seSBzdHJpbmdbXSxcbiAgLi4uYXJnczogYW55W11cbikge1xuXG4gIGlmICh0eXBlb2YgbGl0ZXJhbHMgPT09ICdzdHJpbmcnKSB7XG4gICAgbGl0ZXJhbHMgPSBbbGl0ZXJhbHNdO1xuICB9XG5cbiAgbGV0IHJlc3VsdCA9IGxpdGVyYWxzWzBdO1xuXG4gIGFyZ3MuZm9yRWFjaCgoYXJnLCBpKSA9PiB7XG4gICAgaWYgKGFyZyAmJiBhcmcua2luZCA9PT0gJ0RvY3VtZW50Jykge1xuICAgICAgcmVzdWx0ICs9IGFyZy5sb2Muc291cmNlLmJvZHk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdCArPSBhcmc7XG4gICAgfVxuICAgIHJlc3VsdCArPSBsaXRlcmFsc1tpICsgMV07XG4gIH0pO1xuXG4gIHJldHVybiBwYXJzZURvY3VtZW50KHJlc3VsdCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXNldENhY2hlcygpIHtcbiAgZG9jQ2FjaGUuY2xlYXIoKTtcbiAgZnJhZ21lbnRTb3VyY2VNYXAuY2xlYXIoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRpc2FibGVGcmFnbWVudFdhcm5pbmdzKCkge1xuICBwcmludEZyYWdtZW50V2FybmluZ3MgPSBmYWxzZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVuYWJsZUV4cGVyaW1lbnRhbEZyYWdtZW50VmFyaWFibGVzKCkge1xuICBleHBlcmltZW50YWxGcmFnbWVudFZhcmlhYmxlcyA9IHRydWU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkaXNhYmxlRXhwZXJpbWVudGFsRnJhZ21lbnRWYXJpYWJsZXMoKSB7XG4gIGV4cGVyaW1lbnRhbEZyYWdtZW50VmFyaWFibGVzID0gZmFsc2U7XG59XG5cbmNvbnN0IGV4dHJhcyA9IHtcbiAgZ3FsLFxuICByZXNldENhY2hlcyxcbiAgZGlzYWJsZUZyYWdtZW50V2FybmluZ3MsXG4gIGVuYWJsZUV4cGVyaW1lbnRhbEZyYWdtZW50VmFyaWFibGVzLFxuICBkaXNhYmxlRXhwZXJpbWVudGFsRnJhZ21lbnRWYXJpYWJsZXMsXG59O1xuXG5leHBvcnQgbmFtZXNwYWNlIGdxbCB7XG4gIGV4cG9ydCBjb25zdCB7XG4gICAgZ3FsLFxuICAgIHJlc2V0Q2FjaGVzLFxuICAgIGRpc2FibGVGcmFnbWVudFdhcm5pbmdzLFxuICAgIGVuYWJsZUV4cGVyaW1lbnRhbEZyYWdtZW50VmFyaWFibGVzLFxuICAgIGRpc2FibGVFeHBlcmltZW50YWxGcmFnbWVudFZhcmlhYmxlcyxcbiAgfSA9IGV4dHJhcztcbn1cblxuZ3FsLmRlZmF1bHQgPSBncWw7XG5cbmV4cG9ydCBkZWZhdWx0IGdxbDtcbiIsImV4cG9ydCBpbnRlcmZhY2UgTG9nZ2VyIHtcbiAgZXJyb3I6IExvZ0Z1bmN0aW9uO1xuICBpbmZvOiBMb2dGdW5jdGlvbjtcbiAgd2FybjogTG9nRnVuY3Rpb247XG59XG5cbnR5cGUgTG9nRnVuY3Rpb24gPSAoLi4uYXJnczogYW55W10pID0+IHZvaWQ7XG5cbmV4cG9ydCBjb25zdCBEZWZhdWx0TG9nZ2VyOiBMb2dnZXIgPSBjb25zb2xlO1xuXG5leHBvcnQgY29uc3QgTm9vcExvZ2dlcjogTG9nZ2VyID0ge1xuICBlcnJvcjogKCkgPT4ge30sXG4gIGluZm86ICgpID0+IHt9LFxuICB3YXJuOiAoKSA9PiB7fSxcbn07XG4iLCJpbXBvcnQgeyBOb3JtYWxpemVkQ2FjaGVPYmplY3QgfSBmcm9tICdAYXBvbGxvL2NsaWVudCc7XG5cbmltcG9ydCB7IEFwb2xsb0NsaWVudCwgSW5NZW1vcnlDYWNoZSB9IGZyb20gJy4uL2xpYi9hcG9sbG8tY2xpZW50JztcbmltcG9ydCB7IERlZmF1bHRMb2dnZXIsIExvZ2dlciwgTm9vcExvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZ2dlcic7XG5cbmludGVyZmFjZSBQYW50aGVvbkNsaWVudENvbmZpZyB7XG4gIGRlYnVnPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogVVJMIG9mIHlvdXIgUGFudGhlb24gQ29udGVudCBDbG91ZCBpbnN0YW5jZVxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBJZiB5b3VyIFBhbnRoZW9uIENvbnRlbnQgQ2xvdWQgaW5zdGFuY2UgaXMgaG9zdGVkIGF0IGh0dHBzOi8vcGFudGhlb24tY29udGVudC1jbG91ZC5jb21cbiAgICogLy8gdGhlbiB5b3VyIGhvc3QgaXMgaHR0cHM6Ly9wYW50aGVvbi1jb250ZW50LWNsb3VkLmNvbVxuICAgKiBjb25zdCBwYW50aGVvbkNsaWVudCA9IG5ldyBQYW50aGVvbkNsaWVudCh7XG4gICAqIHBjY0hvc3Q6ICdodHRwczovL3BhbnRoZW9uLWNvbnRlbnQtY2xvdWQuY29tJyxcbiAgICogfSk7XG4gICAqL1xuICBwY2NIb3N0OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFVSTCBvZiB5b3VyIFBhbnRoZW9uIENvbnRlbnQgQ2xvdWQgd2Vic29ja2V0IGhvc3RcbiAgICogQGRlZmF1bHQgcGNjSG9zdFxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBJZiB5b3VyIFBhbnRoZW9uIENvbnRlbnQgQ2xvdWQgaW5zdGFuY2UgaXMgaG9zdGVkIGF0IGh0dHBzOi8vcGFudGhlb24tY29udGVudC1jbG91ZC5jb21cbiAgICogLy8gdGhlbiB5b3VyIHdlYnNvY2tldCBob3N0IGlzIHdzczovL3BhbnRoZW9uLWNvbnRlbnQtY2xvdWQuY29tXG4gICAqIGNvbnN0IHBhbnRoZW9uQ2xpZW50ID0gbmV3IFBhbnRoZW9uQ2xpZW50KHtcbiAgICogIHBjY0hvc3Q6ICdodHRwczovL3BhbnRoZW9uLWNvbnRlbnQtY2xvdWQuY29tJyxcbiAgICogcGNjV3NIb3N0OiAnd3NzOi8vcGFudGhlb24tY29udGVudC1jbG91ZC5jb20nLFxuICAgKiB9KTtcbiAgICovXG4gIHBjY1dzSG9zdD86IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIFBhbnRoZW9uQ2xpZW50IHtcbiAgcHVibGljIGhvc3Q6IHN0cmluZztcbiAgcHVibGljIHdzSG9zdDogc3RyaW5nO1xuICBwdWJsaWMgbG9nZ2VyOiBMb2dnZXI7XG4gIHByaXZhdGUgZGVidWc6IGJvb2xlYW47XG5cbiAgcHVibGljIGFwb2xsb0NsaWVudDogQXBvbGxvQ2xpZW50PE5vcm1hbGl6ZWRDYWNoZU9iamVjdD47XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBQYW50aGVvbkNsaWVudENvbmZpZykge1xuICAgIHRoaXMuaG9zdCA9IGNvbmZpZy5wY2NIb3N0O1xuICAgIHRoaXMud3NIb3N0ID1cbiAgICAgIGNvbmZpZy5wY2NXc0hvc3QgfHxcbiAgICAgIGNvbmZpZy5wY2NIb3N0LnJlcGxhY2UoL15odHRwLywgJ3dzJykucmVwbGFjZSgvXmh0dHBzLywgJ3dzcycpO1xuICAgIHRoaXMuZGVidWcgPSBjb25maWcuZGVidWcgfHwgZmFsc2U7XG4gICAgdGhpcy5sb2dnZXIgPSB0aGlzLmRlYnVnID8gRGVmYXVsdExvZ2dlciA6IE5vb3BMb2dnZXI7XG5cbiAgICBpZiAoIXRoaXMuaG9zdCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIFBhbnRoZW9uIENvbnRlbnQgQ2xvdWQgaG9zdCcpO1xuICAgIH1cblxuICAgIHRoaXMuYXBvbGxvQ2xpZW50ID0gbmV3IEFwb2xsb0NsaWVudCh7XG4gICAgICB1cmk6IGAke3RoaXMuaG9zdH0vcXVlcnlgLFxuICAgICAgY2FjaGU6IG5ldyBJbk1lbW9yeUNhY2hlKCksXG4gICAgfSk7XG5cbiAgICBpZiAodGhpcy5kZWJ1Zykge1xuICAgICAgdGhpcy5sb2dnZXIuaW5mbygnUGFudGhlb25DbGllbnQgaW5pdGlhbGl6ZWQgd2l0aCBjb25maWcnLCBjb25maWcpO1xuICAgIH1cbiAgfVxufVxuIiwiaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VSZWYgfSBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCB7IHVzZVBhbnRoZW9uQ2xpZW50IH0gZnJvbSAnLi4vY29yZS9wYW50aGVvbi1jb250ZXh0JztcbmltcG9ydCB7IHVzZVF1ZXJ5IH0gZnJvbSAnLi4vbGliL2Fwb2xsby1jbGllbnQnO1xuaW1wb3J0IHsgQXJ0aWNsZVF1ZXJ5QXJncywgR0VUX0FSVElDTEVfUVVFUlkgfSBmcm9tICcuLi9saWIvYXJ0aWNsZXMnO1xuaW1wb3J0IHsgQXJ0aWNsZSB9IGZyb20gJy4uL3R5cGVzJztcblxuZXhwb3J0IGNvbnN0IHVzZUFydGljbGUgPSAoaWQ6IHN0cmluZywgYXJncz86IEFydGljbGVRdWVyeUFyZ3MpID0+IHtcbiAgY29uc3QgeyB3c0hvc3QsIGxvZ2dlciB9ID0gdXNlUGFudGhlb25DbGllbnQoKTtcbiAgY29uc3QgcXVlcnlEYXRhID0gdXNlUXVlcnk8eyBhcnRpY2xlOiBBcnRpY2xlIH0+KEdFVF9BUlRJQ0xFX1FVRVJZLCB7XG4gICAgdmFyaWFibGVzOiB7IGlkLCAuLi5hcmdzIH0sXG4gIH0pO1xuXG4gIGNvbnN0IHNvY2tldFJlZiA9IHVzZVJlZjxXZWJTb2NrZXQ+KCk7XG4gIGNvbnN0IGlkUmVmID0gdXNlUmVmPHN0cmluZz4oKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlkUmVmLmN1cnJlbnQgPSBpZDtcbiAgfSwgW2lkXSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoc29ja2V0UmVmLmN1cnJlbnQgIT0gbnVsbCkgcmV0dXJuO1xuXG4gICAgY29uc3Qgc29ja2V0ID0gbmV3IFdlYlNvY2tldChgJHt3c0hvc3R9L3dzYCk7XG4gICAgc29ja2V0UmVmLmN1cnJlbnQgPSBzb2NrZXQ7XG5cbiAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignb3BlbicsICgpID0+IHtcbiAgICAgIGxvZ2dlci5pbmZvKCdDb25uZWN0ZWQgdG8gdGhlIEdyYXBoUUwgYmFja2VuZC4nKTtcblxuICAgICAgc29ja2V0LnNlbmQoXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBDb21tYW5kOiAnc3ViY2hhbmdlcycsXG4gICAgICAgICAgSWQ6IGlkLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCAoKSA9PiB7XG4gICAgICBsb2dnZXIuaW5mbygnJWNEaXNjb25uZWN0ZWQgYW5kIGxvbmVseScsICdjb2xvcjogcmVkOycpO1xuICAgIH0pO1xuXG4gICAgc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAoZSkgPT4ge1xuICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2UoZS5kYXRhKTtcblxuICAgICAgc3dpdGNoIChqc29uLkNvbW1hbmQpIHtcbiAgICAgICAgY2FzZSAncmVmZXRjaCc6IHtcbiAgICAgICAgICBpZiAoanNvbi5JZCA9PT0gaWRSZWYuY3VycmVudCkge1xuICAgICAgICAgICAgbG9nZ2VyLmluZm8oXG4gICAgICAgICAgICAgICclY05ldyBjb250ZW50IGlzIGF2YWlsYWJsZSAtIHJlZmV0Y2hpbmcuLi4nLFxuICAgICAgICAgICAgICAnY29sb3I6IHllbGxvdzsnLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHF1ZXJ5RGF0YS5yZWZldGNoKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgJ2RvY19nb25lJzoge1xuICAgICAgICAgIGlmIChqc29uLklkID09PSBpZFJlZi5jdXJyZW50KSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBIYW5kbGUgY2FzZSB3aGVuIGRvYyB3ZSBhcmUgd2F0Y2hpbmcgaGFzIGJlZW4gZGVsZXRlZC5cbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcignRG9jdW1lbnQgaGFzIGJlZW4gZGVsZXRlZCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlICdkZWJ1Zyc6IHtcbiAgICAgICAgICBsb2dnZXIuaW5mbyh7IGpzb24gfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIGxvZ2dlci5lcnJvcihgVW5yZWNvZ25pemVkIGNvbW1hbmQgJHtqc29uLkNvbW1hbmR9YCwganNvbik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSwgW10pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHNvY2tldFJlZi5jdXJyZW50Py5yZWFkeVN0YXRlID09PSBXZWJTb2NrZXQuT1BFTikge1xuICAgICAgc29ja2V0UmVmLmN1cnJlbnQuc2VuZChcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIENvbW1hbmQ6ICdzdWJjaGFuZ2VzJyxcbiAgICAgICAgICBJZDogaWQsXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICB9XG4gIH0sIFtpZF0pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgbG9nZ2VyLmluZm8oJyVjU3VjY2Vzc2Z1bGx5IGZldGNoZWQgdXBkYXRlZCBjb250ZW50JywgJ2NvbG9yOiBsaW1lOycpO1xuICB9LCBbcXVlcnlEYXRhLmRhdGFdKTtcblxuICByZXR1cm4ge1xuICAgIC4uLnF1ZXJ5RGF0YSxcbiAgICBhcnRpY2xlOiBxdWVyeURhdGEuZGF0YT8uYXJ0aWNsZSxcbiAgfTtcbn07XG4iLCIvKipcbiAqIFN0YXRpYyBoZWxwZXIgZnVuY3Rpb25zIGZvciBhcnRpY2xlc1xuICovXG5cbmltcG9ydCB7IFBhbnRoZW9uQ2xpZW50IH0gZnJvbSAnLi4vLi4vY29yZS9wYW50aGVvbi1jbGllbnQnO1xuaW1wb3J0IHtcbiAgQXJ0aWNsZSxcbiAgQXJ0aWNsZVdpdGhvdXRDb250ZW50LFxuICBDb250ZW50VHlwZSxcbiAgUHVibGlzaGluZ0xldmVsLFxufSBmcm9tICcuLi8uLi90eXBlcyc7XG5pbXBvcnQgeyBncWwgfSBmcm9tICcuLi9hcG9sbG8tY2xpZW50JztcblxuZXhwb3J0IGludGVyZmFjZSBBcnRpY2xlUXVlcnlBcmdzIHtcbiAgY29udGVudFR5cGU/OiBrZXlvZiB0eXBlb2YgQ29udGVudFR5cGU7XG4gIHB1Ymxpc2hpbmdMZXZlbD86IGtleW9mIHR5cGVvZiBQdWJsaXNoaW5nTGV2ZWw7XG59XG5cbmV4cG9ydCBjb25zdCBMSVNUX0FSVElDTEVTX1FVRVJZID0gZ3FsYFxuICBxdWVyeSBMaXN0QXJ0aWNsZXMoXG4gICAgJGNvbnRlbnRUeXBlOiBDb250ZW50VHlwZVxuICAgICRwdWJsaXNoaW5nTGV2ZWw6IFB1Ymxpc2hpbmdMZXZlbFxuICApIHtcbiAgICBhcnRpY2xlcyhjb250ZW50VHlwZTogJGNvbnRlbnRUeXBlLCBwdWJsaXNoaW5nTGV2ZWw6ICRwdWJsaXNoaW5nTGV2ZWwpIHtcbiAgICAgIGlkXG4gICAgICB0aXRsZVxuICAgICAgc291cmNlXG4gICAgICBzb3VyY2VVUkxcbiAgICAgIGtleXdvcmRzXG4gICAgICBwdWJsaXNoZWREYXRlXG4gICAgICBwdWJsaXNoaW5nTGV2ZWxcbiAgICAgIGNvbnRlbnRUeXBlXG4gICAgfVxuICB9XG5gO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QXJ0aWNsZXMoXG4gIGNsaWVudDogUGFudGhlb25DbGllbnQsXG4gIGFyZ3M/OiBBcnRpY2xlUXVlcnlBcmdzLFxuKSB7XG4gIGNvbnN0IGFydGljbGVzID0gYXdhaXQgY2xpZW50LmFwb2xsb0NsaWVudC5xdWVyeSh7XG4gICAgcXVlcnk6IExJU1RfQVJUSUNMRVNfUVVFUlksXG4gICAgdmFyaWFibGVzOiBhcmdzLFxuICB9KTtcblxuICByZXR1cm4gYXJ0aWNsZXMuZGF0YS5hcnRpY2xlcyBhcyBBcnRpY2xlV2l0aG91dENvbnRlbnRbXTtcbn1cblxuZXhwb3J0IGNvbnN0IEdFVF9BUlRJQ0xFX1FVRVJZID0gZ3FsYFxuICBxdWVyeSBHZXRBcnRpY2xlKFxuICAgICRpZDogU3RyaW5nIVxuICAgICRjb250ZW50VHlwZTogQ29udGVudFR5cGVcbiAgICAkcHVibGlzaGluZ0xldmVsOiBQdWJsaXNoaW5nTGV2ZWxcbiAgKSB7XG4gICAgYXJ0aWNsZShcbiAgICAgIGlkOiAkaWRcbiAgICAgIGNvbnRlbnRUeXBlOiAkY29udGVudFR5cGVcbiAgICAgIHB1Ymxpc2hpbmdMZXZlbDogJHB1Ymxpc2hpbmdMZXZlbFxuICAgICkge1xuICAgICAgaWRcbiAgICAgIHRpdGxlXG4gICAgICBjb250ZW50XG4gICAgICBzb3VyY2VcbiAgICAgIHNvdXJjZVVSTFxuICAgICAga2V5d29yZHNcbiAgICAgIHB1Ymxpc2hlZERhdGVcbiAgICAgIHB1Ymxpc2hpbmdMZXZlbFxuICAgICAgY29udGVudFR5cGVcbiAgICB9XG4gIH1cbmA7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBcnRpY2xlKFxuICBjbGllbnQ6IFBhbnRoZW9uQ2xpZW50LFxuICBpZDogc3RyaW5nLFxuICBhcmdzPzogQXJ0aWNsZVF1ZXJ5QXJncyxcbikge1xuICBjb25zdCBhcnRpY2xlID0gYXdhaXQgY2xpZW50LmFwb2xsb0NsaWVudC5xdWVyeSh7XG4gICAgcXVlcnk6IEdFVF9BUlRJQ0xFX1FVRVJZLFxuICAgIHZhcmlhYmxlczogeyBpZCwgLi4uYXJncyB9LFxuICB9KTtcblxuICByZXR1cm4gYXJ0aWNsZS5kYXRhLmFydGljbGUgYXMgQXJ0aWNsZTtcbn1cbiIsImltcG9ydCB7IHVzZVF1ZXJ5IH0gZnJvbSAnLi4vbGliL2Fwb2xsby1jbGllbnQnO1xuaW1wb3J0IHsgQXJ0aWNsZVF1ZXJ5QXJncywgTElTVF9BUlRJQ0xFU19RVUVSWSB9IGZyb20gJy4uL2xpYi9hcnRpY2xlcyc7XG5pbXBvcnQgeyBBcnRpY2xlV2l0aG91dENvbnRlbnQgfSBmcm9tICcuLi90eXBlcyc7XG5cbnR5cGUgTGlzdEFydGljbGVzUmVzcG9uc2UgPSB7XG4gIGFydGljbGVzOiBBcnRpY2xlV2l0aG91dENvbnRlbnRbXTtcbn07XG5cbmV4cG9ydCBjb25zdCB1c2VBcnRpY2xlcyA9IChhcmdzPzogQXJ0aWNsZVF1ZXJ5QXJncykgPT4ge1xuICBjb25zdCBxdWVyeURhdGEgPSB1c2VRdWVyeTxMaXN0QXJ0aWNsZXNSZXNwb25zZT4oTElTVF9BUlRJQ0xFU19RVUVSWSwge1xuICAgIHZhcmlhYmxlczogYXJncyxcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICAuLi5xdWVyeURhdGEsXG4gICAgYXJ0aWNsZXM6IHF1ZXJ5RGF0YS5kYXRhPy5hcnRpY2xlcyxcbiAgfTtcbn07XG4iLCJleHBvcnQgaW50ZXJmYWNlIEFydGljbGUge1xuICBjb250ZW50OiBzdHJpbmcgfCBudWxsO1xuICBjb250ZW50VHlwZToga2V5b2YgdHlwZW9mIENvbnRlbnRUeXBlO1xuICBpZDogc3RyaW5nO1xuICBrZXl3b3Jkczogc3RyaW5nW10gfCBudWxsO1xuICBwdWJsaXNoZWREYXRlOiBzdHJpbmcgfCBudWxsO1xuICBwdWJsaXNoaW5nTGV2ZWw6IGtleW9mIHR5cGVvZiBQdWJsaXNoaW5nTGV2ZWw7XG4gIHNvdXJjZTogc3RyaW5nIHwgbnVsbDtcbiAgc291cmNlVVJMOiBzdHJpbmcgfCBudWxsO1xuICB0aXRsZTogc3RyaW5nIHwgbnVsbDtcbn1cblxuZXhwb3J0IHR5cGUgQXJ0aWNsZVdpdGhvdXRDb250ZW50ID0gT21pdDxBcnRpY2xlLCAnY29udGVudCc+O1xuXG5leHBvcnQgZW51bSBQdWJsaXNoaW5nTGV2ZWwge1xuICBwcm9kdWN0aW9uID0gJ1BST0RVQ1RJT04nLFxuICByZWFsdGltZSA9ICdSRUFMVElNRScsXG4gIHN0YWdpbmcgPSAnU1RBR0lORycsXG59XG5cbmV4cG9ydCBlbnVtIENvbnRlbnRUeXBlIHtcbiAgVEVYVF9NQVJLRE9XTiA9ICdURVhUX01BUktET1dOJyxcbiAgVFJFRV9QQU5USEVPTiA9ICdUUkVFX1BBTlRIRU9OJyxcbn1cbiJdfQ==